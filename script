-- Серверный модуль (должен быть в ServerScriptService)
local ServerModule = Instance.new("ModuleScript")
ServerModule.Name = "TSB_GlobalCombat"
ServerModule.Source = [[
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Players = game:GetService("Players")
    
    -- Создаем удаленные события
    local Events = {
        PlayAnimation = Instance.new("RemoteEvent", ReplicatedStorage),
        SpawnEffect = Instance.new("RemoteEvent", ReplicatedStorage)
    }
    
    Events.PlayAnimation.Name = "TSB_PlayAnim"
    Events.SpawnEffect.Name = "TSB_SpawnEffect"
    
    -- Обработка анимаций
    Events.PlayAnimation.OnServerEvent:Connect(function(player, animData)
        -- Реплицируем анимацию всем игрокам
        for _, target in ipairs(Players:GetPlayers()) do
            if target ~= player then
                Events.PlayAnimation:FireClient(target, player, animData)
            end
        end
    end)
    
    -- Обработка эффектов
    Events.SpawnEffect.OnServerEvent:Connect(function(player, effectData)
        -- Создаем глобальный эффект
        local effect = Instance.new("Part")
        effect.Size = Vector3.new(3, 3, 3)
        effect.Position = effectData.Position
        effect.Anchored = true
        effect.CanCollide = false
        effect.Transparency = 0.3
        effect.Color = effectData.Color
        effect.Material = Enum.Material.Neon
        effect.Parent = workspace
        
        -- Автоудаление через 2 секунды
        delay(2, function() effect:Destroy() end)
        
        -- Реплицируем эффект
        Events.SpawnEffect:FireAllClients(player, effectData)
    end)
]]
ServerModule.Parent = game:GetService("ServerScriptService")

-- Клиентский скрипт (LocalScript)
local Player = game:GetService("Players").LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")

-- Анимации (ID нужно заменить на реальные из TSB)
local TSB_Animations = {
    LightAttack = {
        AnimId = "rbxassetid://9124234871",
        Damage = 15,
        Cooldown = 0.6,
        EffectColor = Color3.fromRGB(255, 100, 100)
    },
    HeavyAttack = {
        AnimId = "rbxassetid://9124236723",
        Damage = 30,
        Cooldown = 1.8,
        EffectColor = Color3.fromRGB(255, 50, 50)
    }
}

-- Загрузка анимаций
for name, data in pairs(TSB_Animations) do
    local anim = Instance.new("Animation")
    anim.AnimationId = data.AnimId
    data.Track = Humanoid:LoadAnimation(anim)
    data.Track.Priority = Enum.AnimationPriority.Action
end

-- Функция для глобальных эффектов
local function CreateGlobalEffect(position, color)
    local effectData = {
        Position = position,
        Color = color
    }
    
    -- Отправляем данные на сервер
    game:GetService("ReplicatedStorage"):WaitForChild("TSB_SpawnEffect"):FireServer(effectData)
end

-- Система атак
local function ExecuteAttack(attackType)
    local attack = TSB_Animations[attackType]
    if not attack then return end
    
    -- Проигрываем анимацию локально
    attack.Track:Play()
    
    -- Реплицируем анимацию другим игрокам
    game:GetService("ReplicatedStorage"):WaitForChild("TSB_PlayAnim"):FireServer({
        Type = attackType,
        Character = Character
    })
    
    -- Создаем эффект удара
    local origin = Character.HumanoidRootPart.Position
    local direction = Character.HumanoidRootPart.CFrame.LookVector * 10
    CreateGlobalEffect(origin + direction, attack.EffectColor)
end

-- Привязка к клавишам
game:GetService("UserInputService").InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Q then
        ExecuteAttack("LightAttack")
    elseif input.KeyCode == Enum.KeyCode.E then
        ExecuteAttack("HeavyAttack")
    end
end)

print("✅ Глобальная боевая система активирована! Эффекты видны всем игрокам.")
